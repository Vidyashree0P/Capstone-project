pseudocode representation of the Systolic core
FUNCTION ProcessingElement(partial_sum_in, weight, input_west):
    # On every Clock Edge:
    IF reset is ACTIVE:
        result = 0
        output_east = 0
    ELSE:
        # Multiply input by weight and add to the sum from the PE above
        result = partial_sum_in + (weight * input_west)
        
        # Pass the input to the neighbor on the right for the next cycle
        output_east = input_west
    RETURN (result, output_east)


FUNCTION WeightMemory():
    # Initialization
    Load 16 values from "weights.hex" into internal memory array
    
    # Parallel Output
    Map all 16 memory slots to a single 512-bit bus (16 slots * 32 bits)
    RETURN all_weights_bus


MODULE SystolicArray:
    # INITIALIZATION
    weights = WeightMemory()
    count = 0
    
    ON clk_edge:
        IF reset:
            count = 0, loaded = False, inputs = 0
        
        # STEP 1: LOAD WEIGHTS
        IF load_trigger AND NOT loaded:
            Load all weights from memory bus into the PE array
            loaded = True
            
        # STEP 2: STAGGERED INPUT FEEDING
        ELSE IF loaded AND count < 7:
            CASE count:
                0: Feed row1_input[0] to PE1
                1: Feed row1_input[1] to PE1; Feed row2_input[0] to PE5
                2: Feed row1_input[2] to PE1; Feed row2_input[1] to PE5; Feed row3_input[0] to PE9
                3: Feed row1_input[3] to PE1; Feed row2_input[2] to PE5; Feed row3_input[1] to PE9; Feed row4_input[0] to PE13
                4: Feed row2_input[3] to PE5; Feed row3_input[2] to PE9; Feed row4_input[1] to PE13
                5: Feed row3_input[3] to PE9; Feed row4_input[2] to PE13
                6: Feed row4_input[3] to PE13
            count = count + 1

        # STEP 3: DATA FLOW (PE Connections)
        FOR row 0 to 3, col 0 to 3:
            Current_PE = PE[row][col]
            Current_PE.weight = weights[row*4 + col]
            
            # Horizontal Flow: Connect west input to east output of previous PE
            # Vertical Flow:   Connect partial_sum to result of PE above
            Current_PE.process()

    # OUTPUTS
    Return results from the bottom row (PE13, PE14, PE15, PE16) as Re1, Re2, Re3, Re4
